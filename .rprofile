
#### TEMPORARY
#### (for STAT319 projects)
##files <- c(
##    '~/github/courses/stat319/projects/trading/trading_code.R',
##    '~/github/courses/stat319/projects/baseball_statistics/baseball_code.R',
##    '~/github/courses/stat319/projects/global_demographics/global_code.R',
##    '~/github/courses/stat319/projects/spam_classification/spam_code.R'
##)
##for(f in files) source(f)
####
####

options(device = 'quartz')

## Berkeley CRAN mirror appears to have disappeared, Feb 2020
##options(repos  = 'http://cran.cnr.berkeley.edu')
options(repos  = 'https://cran.ma.imperial.ac.uk/')

options(scipen=999)  ## turns off scientific notation display

##roundSig <- function(x) round(x, -floor(log10(abs(x))))

build <- function(x) {
    if('nimble' %in% .packages())   return(invisible())    ## return if nimble already loaded
    x <- as.character(substitute(x))
    if(length(x) > 1) stop('need to put the build name in quotes for calling the build function()')
    buildDir <- paste0('~/temp/builds/', x)
    if(!file.exists(buildDir)) stop(paste0('no build: ', buildDir), call. = FALSE)
    message('==============================================')
    message(paste0('loading nimble build: ', x))
    message('==============================================')
    library(nimble, lib.loc = buildDir)
}

makeActiveBinding('ppp', function() conf$printSamplers(byType = TRUE), .GlobalEnv)

makeActiveBinding('pppp', function() conf$printSamplers(), .GlobalEnv)

makeActiveBinding('qqq', function() q('no'), .GlobalEnv)

makeActiveBinding('rrr', function() eval(quote(rm(list = setdiff(ls(), c(
                                                                           'build',
                                                                           'ppp',
                                                                           'pppp',
                                                                           'qqq',
                                                                           'rrr'
                                                                       )))), envir = .GlobalEnv), .GlobalEnv)

## make L as the first argument of (the function call) R
## this is a new feature in newer versions of R (actually: `|>` )
`%|>%` <- function(L, R) {
    R <- substitute(R)
    L <- substitute(L)
    newR <- R
    newR[[2]] <- L
    lenR <- length(R)
    if(length(R) > 1) {
        newR[3:(lenR+1)] <- R[2:lenR]
        if(!is.null(names(R)))   names(newR)[3:(lenR+1)] <- names(R)[2:lenR]
    }
    return(eval(newR, parent.frame()))
}

##stan_model <- function(...) {
##    suppressWarnings(rm(ppp, pppp, qqq, envir = .GlobalEnv))
##    out <- rstan::stan_model(...)
##    makeActiveBinding('ppp', function() conf$printSamplers(byType = TRUE), .GlobalEnv)
##    makeActiveBinding('pppp', function() conf$printSamplers(), .GlobalEnv)
##    makeActiveBinding('qqq', function() q('no'), .GlobalEnv)
##    invisible(out)
##}



